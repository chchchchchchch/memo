
 \usepackage[utf8]{inputenc}
%\usepackage[showframe]{geometry}
 \usepackage{geometry}
 \usepackage{pdfpages}
 \usepackage{scalefnt}
% https://groups.google.com/forum/#!topic/pandoc-discuss/_tssxEsT0eg
 \usepackage{enumerate}
 \usepackage{twoopt,ifmtarg}

%\usepackage{natbib}
 \usepackage{bibentry}
 \nobibliography*


% A5 + CROP (online-druck.biz)
 \geometry{paperwidth=154mm,paperheight=216mm}

 \setlength\oddsidemargin{.08\paperwidth}
 \setlength\evensidemargin{-.06\paperwidth}
 \setlength\topmargin{-.09\paperheight}
 \setlength\textheight{.79\paperheight}
 \setlength\textwidth{.65\paperwidth}

 \setlength\marginparwidth{2.5cm}
 \setlength\marginparsep{5mm}


%\renewcommand{\parskip}{\vspace{15pt plus 10pt minus 10pt}}
 \parindent=0pt


% http://texblog.org/2007/11/07/headerfooter-in-latex-with-fancyhdr/
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead{} % CLEAR DEFAULT
  \fancyfoot{} % CLEAR DEFAULT

  \renewcommand{\headrulewidth}{0pt}
 %\fancyhead[CO,CE]{---Draft---}
 %\fancyfoot[C]{\thepage}
 %\fancyfoot[RO,LE]{\thepage}
 %\fancyfoot[RE,LO]{\thepage}

  \fancyfoot[LO]{\hspace{-20mm} {\footnotesize\thepage}}
  \fancyfoot[RE]{{\footnotesize\thepage} \hspace{-20mm}}



% Keine "Schusterjungen"
  \clubpenalty = 10000
% Keine "Hurenkinder"
  \widowpenalty = 100000
  \displaywidowpenalty = 100000
  \looseness=1

% http://tex.stackexchange.com/questions/21983/how-to-avoid-page-breaks-inside-paragraphs
% \widowpenalties 1 10000

% PREVENT HYPHENATION FOR WORDS STARTING WITH UPPERCASE
  \uchyph=0
% PREVENT HYPHENATION OVER PAGE BREAK
  \brokenpenalty10000\relax



  \renewcommand{\encodingdefault}{T1}

  \newcommand{\ttstandard}{asc}
  \newcommand{\rmstandard}{phv}
  \newcommand{\sfstandard}{phv}

% PROBLEMS WITH SCALEFONT PACKAGE
% LINEHEIGHT
  \usepackage{setspace}
 %\singlespacing
 %\onehalfspacing
 %\doublespacing
  \setstretch{1.3}

  \usepackage{relsize}


  \renewcommand{\ttdefault}{\ttstandard}
  \renewcommand{\rmdefault}{\rmstandard}
  \renewcommand{\sfdefault}{\sfstandard}

  \let\OldTexttt\texttt
  \renewcommand{\texttt}[1]{%
  \OldTexttt{\fontfamily{asc}%
              \selectfont{%
               \textbf{\relscale{1.05}{#1}}}}}





% FOOTNOTES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \usepackage[hang,multiple]{footmisc}
  \renewcommand{\footnotelayout}{\raggedright}

% SMALLER DISTANCE FOOTNOTENUMBER AND TEXT
  \let\oldfootnote\footnote
% \, = small non-breaking space
   \renewcommand\footnote[1]{\,\oldfootnote{#1}}

  \setlength{\footnotemargin}{1em}

  \setlength{\footskip}{15mm}
 % ABSTAND TRENNLINIE FUSSNOTEN
   \renewcommand{\footnoterule}{
    \vspace*{5mm}
     \noindent
      \rule{\textwidth}{0.5pt}{
       \vspace*{-3pt}
  }}



% DISABLED FOR BIBER
% \newif\iffootnote
% \let\Footnote\footnote
% \renewcommand\footnote[1]{\begingroup\footnotetrue\Footnote{#1}\endgroup}




% HEADLINES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 \usepackage{sectsty}

 \renewcommand*{\chapterheadstartvskip}{\vspace{10pt}}
 \renewcommand*{\chapterheadendvskip}{\vspace{.5cm plus 5pt minus 5pt}}
 
 \renewcommand*\thechapter{\hspace{-.5em}} % ?
 \renewcommand*\thesection{\hspace{-.5em}}
 \renewcommand*\thesubsection{\hspace{-.5em}}

  \renewcommand\section[1]{
   \bigskip
    \sloppy%
    {\fontfamily{pju}\selectfont%
     %\large\underline{#1}}%
       \Large #1}%
        \medskip%
         \fussy%
   }

 \subsectionfont{\fontfamily{lju}\selectfont}
 \subsectionfont{\relscale{1.2}\fontfamily{pju}\selectfont}




  \usepackage{everypage}

   \makeatletter
    \newcommand{\grafikoverlay}[1]{
     \AddToShipoutPicture*{%
      \setlength{\unitlength}{.1\paperwidth}%
       \ifodd\value{page}%
        \put(0.2,12.5){%
         \includegraphics[width=2.5\marginparwidth]
          {#1}}
           \else
            \put(8.1,12.5){%
             \includegraphics[width=2.5\marginparwidth]
              {#1}}
               \fi
   }}\makeatother
   
%  \newcommand\oddornot{% 
%   \ifodd\value{page}%
%  odd %
%     \else%
%  even %
%       \fi%
%  }

   \newcommand\qroverlay[2]{
   \AddThispageHook{
   \newpage
   \grafikoverlay{#1}
   }}



% -------------------------------------------------------------------- %
   \newcommand\pdfpage[3]{%
   \includepdf[pagecommand={\thispagestyle{fancy}},%
               scale=1,pages=#2#3]{#1}
  }
% -------------------------------------------------------------------- %
  \newcommand{\resetfont}{
  % http://www.forkosh.com/pstex/latexcommands.htm
    \normalfont%
    \normalsize%
   }

% -------------------------------------------------------------------- %
% P A G E   C O M M A N D S
% -------------------------------------------------------------------- %
  \newcommand{\emptypage}{ % SOMEHOW HACKY
   \twocolumn[]\thispagestyle{empty} %
    \onecolumn %
   }
% -------------------------------------------------------------------- %
% MAKE PAGE AMOUNT DIVIDABLE BY FOUR
% https://groups.google.com/forum/#!topic/de.comp.text.tex/j8wWMv8lZaM
  \newcount\vs
  \newcount\vsi
  \newcommand\cleartofour{
   \mbox{}\clearpage
   \pagestyle{empty}
   \vs\thepage
   \advance\vs by 3
   \vsi\vs
   \divide\vs by 4
   \multiply\vs by 4
   \ifnum\vs=\vsi\else\cleartofour\fi
  }
% -------------------------------------------------------------------- %
  \newcommand\cleartoleft{%
% \clearpage
% \ifodd\value{page}\emptypage\fi
  \clearpage
  \ifthispageodd{\emptypage}{}
 }
% -------------------------------------------------------------------- %
  \newcommand\cleartoright{%
% \clearpage
% %\ifeven\value{page}
% \emptypage
% %\fi
  \clearpage
% http://tex.stackexchange.com/questions/6143/if-then-else-for-odd-page-even-page
  \ifthispageodd{}{\emptypage}
 }
% -------------------------------------------------------------------- %





% -------------------------------------------------------------------- %

  \usepackage{marginnote}
   \reversemarginpar
    \newcommand\qrmargin[2]{%
     \marginpar{
      ~ \\ % NOTHING NEEDED
      \vspace{-10mm}\\
       \includegraphics[width=\marginparwidth]{#1}%
    }
   }

 \usepackage{afterpage}
   \newcommand\fullpagefloat[1]{%
    \afterpage{
     \includepdf{#1}
    }
   }


% SRCODE (DIFFERENT IF BEFORE CITATION BLOCK???!)
% -------------------------------------------------------------------- %
  \usepackage{listings}

  \definecolor{darkblue}{cmyk}{1,0,0,0}
  \definecolor{darkred}{cmyk}{0,1,0,0}
  \definecolor{darkgreen}{cmyk}{1,0,1,0}
  \definecolor{red}{cmyk}{0,0,1,0}

  \lstloadlanguages{Bash}
  \lstset{%
    language=Bash,
    basicstyle=\fontfamily{asc}\selectfont\footnotesize,
  % commentstyle=\itshape\color{darkgreen},
  % commentstyle=\fontfamily{vpi}\selectfont,
    commentstyle=\scalefont{.7}\em,
  % keywordstyle=\bfseries\color{darkblue},
    keywordstyle=\em,
    stringstyle=\color{darkred},
    showspaces=false,
    showtabs=false,
    columns=fixed,
  % numbers=left,
    numbers=none,
    frame=none,
    numberstyle=\tiny,
    breaklines=false,
    showstringspaces=false,
    xleftmargin=0cm
  }%


%%\lstloadlanguages{C++}
%%\lstloadlanguages{TeX}
%\lstloadlanguages{Bash}
%\lstset{%
%% language=C++,
%% language=TeX,
%  language=Bash,
%% basicstyle=\tiny\ttfamily,
%  basicstyle=\tiny\ttfamily,
%% commentstyle=\itshape\color{darkgreen},
%% keywordstyle=\bfseries\color{darkblue},
%  stringstyle=\color{darkred},
%  showspaces=false,
%  showtabs=false,
%  columns=fixed,
%  numbers=left,
%  frame=none,
%  numberstyle=\tiny,
%  breaklines=true,
%  showstringspaces=false,
%  xleftmargin=0cm
%}%



% CITATION
% -------------------------------------------------------------------- %
% \usepackage{forloop}
% \usepackage{environ}

  \usepackage{csquotes}
% \usepackage{btxdockit} % CLASH LSTLISTING????

%\usepackage[bibstyle=fiwi,natbib=true,backend=biber]{biblatex}
%\bibliography{../references.bib}
% \usepackage[style=fiwi,
%             citestyle=fiwi,
%             backend=biber,
%             natbib=true,
%             citefilm=normal,
%             series=false,
%             publisher=true,germ=true,origyearwithyear=true,origyearsuperscript=true,dashed=true,partofcited=true,]{biblatex}
 \usepackage[style=fiwi,natbib=true,backend=biber]{biblatex}

% PROBLEM WITH SPACING AFTER FILMTITLE
% OVERWRITE FORMATTING
 %\DeclareFieldFormat[book]{title}{{{#1 XX}}}     % HAS EFFECT
 %\DeclareFieldFormat[book]{title}{{{\emph{#1}}}} % HAS EFFECT
 %\DeclareRobustCommand{\film}{}  % HAS EFFECT
 \renewbibmacro*{director}{
 %\ifpunct{\unspace}{}\printnames[director]{author}
 \ifpunct{}{}\printnames[director]{author}
 }
 \DeclareFieldFormat{season}{ {\textsc\emph{season}} #1}
 \DeclareFieldFormat{episode}{ {\textsc\emph{episode}} #1}

% http://www.khirevich.com/latex/biblatex/
% prints author names as small caps
% \renewcommand{\mkbibnamefirst}[1]{\textsc{#1}}
% \renewcommand{\mkbibnamelast}[1]{\textsc{#1}}
% \renewcommand{\mkbibnameprefix}[1]{\textsc{#1}}
% \renewcommand{\mkbibnameaffix}[1]{\textsc{#1}}

 \newif\iffootnote
 \let\Footnote\footnote
 \renewcommand\footnote[1]{\begingroup\footnotetrue\Footnote{#1}\endgroup}

 \renewcommand\cite[1]{%
 \iffootnote 
  { \mbox{\tiny\fullcite{#1}}}
 \else
  \footnote{\fullcite{#1}}%
 \fi
 }

 \usepackage{twoopt,ifmtarg}
 \let\oldcitep\citealp
 \makeatletter
 \renewcommandtwoopt\citep[3][][]{%
 \iffootnote 
  \begingroup\protected\def\harvardand{\&}%
  \@ifmtarg{#1}%
  { {\tiny\fullcite{#3}}}%
  {\@ifmtarg{#2}%
  { {\tiny\fullcite{#3}, #1}}%
  { {\tiny\fullcite{#3}, #1, #2}}}%
  \endgroup%
 \else
  \begingroup\protected\def\harvardand{\&}%
  \@ifmtarg{#1}%
  {\footnote{\fullcite{#3}}}%
  {\@ifmtarg{#2}%
  {\footnote{\fullcite{#3}, #1}}%
  {\footnote{\fullcite{#3}, #1, #2}}}%
  \endgroup%
 \fi
 }
 \makeatother
 \protected\def\harvardand{and}











%% -------------------------------------------------------------------- %
%% PDF/X COMPLIANCY
%% -------------------------------------------------------------------- %
%  \usepackage[x-1a]{pdfx}
%  \usepackage{filecontents}
%  \begin{filecontents*}{\jobname.xmpdata}
%  \Keywords{pdfTeX\sep PDF/X-1a\sep PDF/A-b}
%  \Title{$(echo echo) echo $(echo): Commandline Poetics}
%  \Author{Florian Cramer}
%  \Org{LAFKON Publishing}
%  \Doi{123456789}
%  \end{filecontents*}
%  \pdfpageattr{/MediaBox [0 0 436 612]
%               /TrimBox [8 8 428 604]}
%  \pdfcatalog{
%  /OutputIntents [ <<
%  /Info (none)
%  /Type /OutputIntent
%  /S /GTS_PDFX
%  /OutputConditionIdentifier (OFCOM_PO_P1_F60_95)
%  /RegistryName (http://www.color.org/)
%    >> ]
%  }


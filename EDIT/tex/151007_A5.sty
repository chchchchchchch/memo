
 \usepackage[utf8]{inputenc}
%\usepackage{ucs}

%\usepackage[showframe]{geometry}
 \usepackage{geometry}
 \usepackage{pdfpages}
 \usepackage{scalefnt}
% https://groups.google.com/forum/#!topic/pandoc-discuss/_tssxEsT0eg
 \usepackage{enumerate}
 \usepackage{twoopt,ifmtarg}
 \usepackage{EDIT/tex/151014_listing}
 \usepackage{alltt} % USED BY QUAVERBATIM
 \usepackage{sectsty}
 \usepackage{titlesec}

% https://en.wikibooks.org/wiki/LaTeX/Special_Characters
  \usepackage{pifont}

% PROBLEMS WITH SCALEFONT PACKAGE
% LINEHEIGHT
  \usepackage{setspace}
 %\singlespacing
 %\onehalfspacing
 %\doublespacing
  \setstretch{1.3}
  \usepackage{relsize}

  \usepackage{nohyperref}
% https://groups.google.com/forum/#!topic/pandoc-discuss/O-N0H1eBnVU
  \let\oldhref=\href 
  \renewcommand{\href}[2]{#2\footnote{#1}}



  \usepackage{enumitem}
 %\setitemize[0]{leftmargin=*}
  \setitemize[0]{leftmargin=10pt,rightmargin=10pt}
  \setlist{noitemsep}


  \makeatletter
  \renewenvironment{quote}
                 {\list{}{\listparindent=2pt%whatever you need
                          \itemindent    \listparindent
                          \leftmargin=15pt%  whatever you need
                          \rightmargin=30pt%whatever you need
                          \topsep=5pt%%%%%  whatever you need
                          \parsep        \z@ \@plus\p@}%
                  \item\relax}
                 {\endlist}
  \makeatother




% http://tex.stackexchange.com/questions/167823/multiply-define-a-label-on-purpose
  \makeatletter
  \def\@newl@bel#1#2#3{{%
    \@ifundefined{#1@#2}%
      {\def\tmp{#3}}%
      {%
  \edef\tmp{%
    {\expandafter\expandafter\expandafter\@firstoftwo\csname#1@#2\endcsname,
     \@firstoftwo#3}%
    {\expandafter\expandafter\expandafter\@secondoftwo\csname#1@#2\endcsname,
     \@secondoftwo#3}%
  }}%
      \expandafter\xdef\csname#1@#2\endcsname{\tmp}%
  }}
  \def\@testdef #1#2#3{}
  \makeatother

%\usepackage{natbib}
  \usepackage{bibentry}
  \nobibliography*

% DON'T START CHAPTER ON NEW PAGE AUTOMATICALLY
  \usepackage{etoolbox}
  \makeatletter
  \patchcmd{\chapter}{\if@openright\cleardoublepage\else\clearpage\fi}{}{}{}
  \makeatother



% --------------------------------------------------------------------------- %
% FORMAT
% --------------------------------------------------------------------------- %
% A5 + CROP (online-druck.biz)
 \geometry{paperwidth=154mm,paperheight=216mm}

 \setlength\oddsidemargin{.05\paperwidth}
 \setlength\evensidemargin{-.03\paperwidth}
 \setlength\topmargin{-.07\paperheight}
 \setlength\textheight{.77\paperheight}
 \setlength\textwidth{.65\paperwidth}

 \setlength\marginparwidth{2.5cm}
 \setlength\marginparsep{1mm}







 \parindent=0pt
 \setlength{\parskip}{5pt plus 5pt minus 5pt}

%% Keine "Schusterjungen"
%  \clubpenalty = 10000
%% Keine "Hurenkinder"
%  \widowpenalty = 100000
%  \displaywidowpenalty = 100000
%  \looseness=1
%
%% http://tex.stackexchange.com/questions/21983/how-to-avoid-page-breaks-inside-paragraphs
%% \widowpenalties 1 10000

 \usepackage[defaultlines=5,all]{nowidow}


% PREVENT HYPHENATION FOR WORDS STARTING WITH UPPERCASE
  \uchyph=0
% PREVENT HYPHENATION OVER PAGE BREAK
  \brokenpenalty10000\relax
% PREVENT PAGE BREAK WITHIN LISTS
  \let\ITEMIZE\itemize
  \let\ENDITEMIZE\enditemize
  \renewenvironment{itemize}{\begin{samepage}\ITEMIZE}
                            {\ENDITEMIZE\end{samepage}}

% --------------------------------------------------------------------------- %
% CONDITIONS
% --------------------------------------------------------------------------- %

% IF BODYTEXT WORKAROUND; TO DO BETTER
  \newif\ifbodytext
  \bodytexttrue
% SET CONDITION (AND BY THE WAY REMOVE NUMBERING (=\chapter*{x}))
  \let\Chapter\chapter
  \renewcommand\chapter[1]{\bodytextfalse\Chapter*{#1}\bodytexttrue}
  \let\Section\section
  \renewcommand\section[1]{\bodytextfalse\Section*{#1}\bodytexttrue}
  \let\Subsection\subsection
  \renewcommand\subsection[1]{\bodytextfalse\Subsection*{#1}\bodytexttrue}
  \let\Subsubsection\subsubsection
  \renewcommand\subsubsection[1]{\bodytextfalse\Subsubsection*{#1}\bodytexttrue}
% TODO: HEADER/FOOTER/TOC


% IF FOOTNOTE (+NOT BODYTEXT)
  \newif\iffootnote
  \let\Footnote\footnote
  \renewcommand\footnote[1]{%
  \begingroup%
  \bodytextfalse%
  \footnotetrue\Footnote{#1}%
  \bodytexttrue%
  \endgroup}



% --------------------------------------------------------------------------- %
% F O N T S
% --------------------------------------------------------------------------- %

  \renewcommand{\encodingdefault}{T1}

  \newcommand{\ttstandard}{grm}
  \newcommand{\rmstandard}{phv}
  \newcommand{\sfstandard}{phv}

  \renewcommand{\ttdefault}{\ttstandard}
  \renewcommand{\rmdefault}{\rmstandard}
  \renewcommand{\sfdefault}{\sfstandard}

  \let\OldTexttt\texttt
  \renewcommand{\texttt}[1]{%
  \OldTexttt{\fontfamily{\ttstandard}%
              \selectfont{%
               \textbf{\relscale{1.05}{#1}}}}}


% HEADLINES
% --------------------------------------------------------------------------- %
% PACKAGE SECTSTY

  \renewcommand*{\chapterheadstartvskip}{\vspace{0pt}}
  \renewcommand*{\chapterheadendvskip}{\vspace{0pt}}
 %\renewcommand*{\sectionheadstartvskip}{\vspace{20pt plus 15pt minus 15pt}}
 %\renewcommand*{\sectionheadendvskip}{\vspace{-20pt plus 10pt minus 20pt}}

  \chapterfont{\relscale{3.5}\setstretch{1.0}}
  \sectionfont{\relscale{1.5}\fontfamily{pju}\selectfont}
  \subsectionfont{\relscale{0.9}%
                   \fontfamily{pju}\selectfont}

% PACKAGE TITLESEC
 %\titlespacing{command}{left spacing}{before spacing}{after spacing}[right]
  \titlespacing\section{0pt}{20pt plus 30pt minus 15pt}{2pt plus 3pt minus 0pt}


% CONDITIONAL FONT STUFF
% --------------------------------------------------------------------------- %

% CHANGE \emph FOR BODYTEXT
  \DeclareTextFontCommand{\emph}{%
    \ifbodytext%
    \fontfamily{pju}\fontshape{it}%
    \selectfont\relscale{1.2}%
    \else\em %
    \fi%
  }

% -------------------------------------------------------------------- %
  \newcommand{\resetfont}{%
  % http://www.forkosh.com/pstex/latexcommands.htm
    \normalfont\normalsize%
   }






% --------------------------------------------------------------------------- %
% CUSTOM COMMANDS
% --------------------------------------------------------------------------- %
% AUTHOR SUBLINE (% BY: xyz)
  \newcommand\by[1]{%
  \small{by #1}
  \vspace{10pt plus 20pt minus 5pt}
  }




% --------------------------------------------------------------------------- %
% CUSTOM ENVIRONMENTS
% --------------------------------------------------------------------------- %

  \usepackage{seqsplit}
  \newenvironment{logfile}{\fontfamily{asc}\selectfont\tiny}
                          {\par}

  \newenvironment{marginblock}{%
   \ifthispageodd{
    \begin{tabular}{ll}  \hspace{-4mm} & } % SHIFT FOR ODD
    {\begin{tabular}{ll} \hspace{-2mm} & } % SHIFT FOR EVEN
      \begin{minipage}{.7\marginparwidth}  %
       \tiny\ifthispageodd{\flushright}{\flushleft}
     }{\end{minipage}\end{tabular}}

  \newenvironment{marginlicenseblock}{%
  \vspace{-.5cm}
   \ifthispageodd{
    \begin{tabular}{ll}  \hspace{-5mm} & } % SHIFT FOR ODD
    {\begin{tabular}{ll} \hspace{-1mm} & } % SHIFT FOR EVEN
      \begin{minipage}{.64\marginparwidth}  %
%      \scalefont{.5}\ifthispageodd{\flushright}{\flushleft}
        \ifthispageodd{\flushright}{\flushleft}
     }{\end{minipage}\end{tabular}}


% --------------------------------------------------------------------------- %
% PAGE/HEADER FOOTER
% --------------------------------------------------------------------------- %

% http://texblog.org/2007/11/07/headerfooter-in-latex-with-fancyhdr/
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead{} % CLEAR DEFAULT
  \fancyfoot{} % CLEAR DEFAULT

  \renewcommand{\headrulewidth}{0pt}
 %\fancyhead[CO,CE]{---Draft---}
 %\fancyfoot[C]{\thepage}
 %\fancyfoot[RO,LE]{\thepage}
 %\fancyfoot[RE,LO]{\thepage}

  \fancyfoot[LO]{\hspace{-15mm} {\footnotesize\thepage}}
  \fancyfoot[RE]{{\footnotesize\thepage} \hspace{-15mm}}

% http://tex.stackexchange.com/questions/114956/how-to-insert-footer-in-first-pages-of-chapter 
  \fancypagestyle{plain}{%
  \fancyfoot[LO]{\hspace{-15mm} {\footnotesize\thepage}}
  \fancyfoot[RE]{{\footnotesize\thepage} \hspace{-15mm}}
  }


% --------------------------------------------------------------------------- %
% TABLE OF CONTENT
% --------------------------------------------------------------------------- %
 \usepackage{tocloft}
 \setlength{\cftbeforetoctitleskip}{-4em}
 \setlength{\cftaftertoctitleskip}{1.5em}
 \setlength{\cftbeforechapskip}{.6em}

% \cftsetindents{chapter}{0pt}{0em}
% \renewcommand\cftpartnumwidth{0cm}
%%\renewcommand{\cfttoctitlefont}{\normalfont\Large\bfseries\MakeUppercase}
% \renewcommand{\cftchappagefont}{\footnotesize\fontfamily{ocr}\selectfont}

%http://tex.stackexchange.com/questions/28516/how-to-change-the-title-of-toc
%\addto\captionsenglish{\renewcommand{\contentsname}{}}
 \renewcommand{\contentsname}{}

 \tocloftpagestyle{empty}







% --------------------------------------------------------------------------- %
% FOOTNOTES 
% --------------------------------------------------------------------------- %
  \usepackage[hang,multiple]{footmisc}
  \renewcommand{\footnotelayout}{\raggedright}

% SMALLER DISTANCE FOOTNOTENUMBER AND TEXT
  \let\oldfootnote\footnote
% \, = small non-breaking space
   \renewcommand\footnote[1]{\,\oldfootnote{#1}}

  \setlength{\footnotemargin}{1em}

  \setlength{\footskip}{15mm}
 % ABSTAND TRENNLINIE FUSSNOTEN
   \renewcommand{\footnoterule}{
    \vspace*{5mm}
     \noindent
      \rule{\textwidth}{0.5pt}{
       \vspace*{-3pt}
  }}







% --------------------------------------------------------------------------- %
% QR
% --------------------------------------------------------------------------- %

  \usepackage{everypage}

   \makeatletter
    \newcommand{\grafikoverlay}[1]{
     \AddToShipoutPicture*{%
      \setlength{\unitlength}{.1\paperwidth}%
       \ifodd\value{page}%
        \put(0.3,12.2){%
         \includegraphics[width=\marginparwidth]
          {#1}}
           \else
            \put(8.1,12.2){%
             \includegraphics[width=\marginparwidth]
              {#1}}
               \fi
   }}\makeatother
   
%  \newcommand\oddornot{% 
%   \ifodd\value{page}%
%  odd %
%     \else%
%  even %
%       \fi%
%  }

   \newcommand\qroverlay[2]{
   \AddThispageHook{
   \newpage
   \grafikoverlay{#1}
   }}


% \usepackage{marginnote}
%  \reversemarginpar
%   \newcommand\qrmargin[2]{%
%    \marginpar{
%      ~ \\ % NOTHING NEEDED
%      \vspace{-10mm}\\
%       \includegraphics[width=\marginparwidth]{#1}
%        \smallskip
%   }\vspace{-2\baselineskip}
%  }

% VERTICAL SPACE HACK
% http://tex.stackexchange.com/questions/61627/prevent-action-if-top-of-page
  \newcommand\vspacenotonpagetop{%
     \par % make sure we end a paragraph
     \vskip10pt % space above the rule
     \leaders\vrule width \textwidth\vskip0pt % rule thickness is 0pt
     \nointerlineskip % disable interline glue here
     \vskip10pt % space below the rule
  }
  \usepackage{marginnote}
   \reversemarginpar
    \newcommand\qrmargin[2]{%
     \vspacenotonpagetop
      \marginpar{
        ~ \\ % NOTHING NEEDED
        \vspace{-15mm}\\
         \includegraphics[width=\marginparwidth]{#1}
          \smallskip\smallskip
    }\vspace{-1.5\baselineskip}
   }

% http://tex.stackexchange.com/questions/88616/fbox-around-type-area

% \usepackage{xparse}

% \newsavebox{\fminipagebox}
% \NewDocumentEnvironment{fminipage}{m O{\fboxsep}}
%  {\par\kern#2\noindent\begin{lrbox}{\fminipagebox}
%    \begin{minipage}{#1}\ignorespaces}
%  {\end{minipage}\end{lrbox}%
%   \makebox[#1]{%
%     \kern\dimexpr-\fboxsep-\fboxrule\relax
%     \fbox{\usebox{\fminipagebox}}%
%     \kern\dimexpr-\fboxsep-\fboxrule\relax
%   }\par\kern#2
%  }


% -------------------------------------------------------------------- %
% P A G E   C O M M A N D S
% -------------------------------------------------------------------- %
  \newcommand{\emptypage}{ % SOMEHOW HACKY
   \twocolumn[]\thispagestyle{empty} %
    \onecolumn %
   }
% -------------------------------------------------------------------- %
% MAKE PAGE AMOUNT DIVIDABLE BY FOUR
% https://groups.google.com/forum/#!topic/de.comp.text.tex/j8wWMv8lZaM
  \newcount\vs
  \newcount\vsi
  \newcommand\cleartofour{
   \mbox{}\clearpage
   \pagestyle{empty}
   \vs\thepage
   \advance\vs by 3
   \vsi\vs
   \divide\vs by 4
   \multiply\vs by 4
   \ifnum\vs=\vsi\else\cleartofour\fi
  }
% -------------------------------------------------------------------- %
  \newcommand\cleartoleft{%
% \clearpage
% \ifodd\value{page}\emptypage\fi
  \clearpage
  \ifthispageodd{\emptypage}{}
 }
% -------------------------------------------------------------------- %
  \newcommand\cleartoright{%
% \clearpage
% %\ifeven\value{page}
% \emptypage
% %\fi
  \clearpage
% http://tex.stackexchange.com/questions/6143/if-then-else-for-odd-page-even-page
  \ifthispageodd{}{\emptypage}
 }
% -------------------------------------------------------------------- %


% -------------------------------------------------------------------- %
% CITATION
% -------------------------------------------------------------------- %
% \usepackage{forloop}
% \usepackage{environ}

  \usepackage{csquotes}
% \usepackage{btxdockit} % CLASH LSTLISTING????

%\usepackage[bibstyle=fiwi,natbib=true,backend=biber]{biblatex}
%\bibliography{../references.bib}
% \usepackage[style=fiwi,
%             citestyle=fiwi,
%             backend=biber,
%             natbib=true,
%             citefilm=normal,
%             series=false,
%             publisher=true,germ=true,origyearwithyear=true,origyearsuperscript=true,dashed=true,partofcited=true,]{biblatex}
 \usepackage[style=fiwi,natbib=true,backend=biber]{biblatex}
%\usepackage[style=verbose-ibid,citetracker,natbib=true,backend=biber]{biblatex} % NOT WORKING !!!!!

% PROBLEM WITH SPACING AFTER FILMTITLE
% OVERWRITE FORMATTING
 %\DeclareFieldFormat[book]{title}{{{#1 XX}}}     % HAS EFFECT
 %\DeclareFieldFormat[book]{title}{{{\emph{#1}}}} % HAS EFFECT
 %\DeclareRobustCommand{\film}{}  % HAS EFFECT
 \renewbibmacro*{director}{
 %\ifpunct{\unspace}{}\printnames[director]{author}
 \ifpunct{}{}\printnames[director]{author}
 }
 \DeclareFieldFormat{season}{ {\textsc\emph{season}} #1}
 \DeclareFieldFormat{episode}{ {\textsc\emph{episode}} #1}

% http://www.khirevich.com/latex/biblatex/
% prints author names as small caps
% \renewcommand{\mkbibnamefirst}[1]{\textsc{#1}}
% \renewcommand{\mkbibnamelast}[1]{\textsc{#1}}
% \renewcommand{\mkbibnameprefix}[1]{\textsc{#1}}
% \renewcommand{\mkbibnameaffix}[1]{\textsc{#1}}

 \renewcommand\cite[1]{%
 \iffootnote 
  { \mbox{\tiny\fullcite{#1}}}
 \else
  \footnote{\fullcite{#1}}%
 \fi
 }

 \usepackage{twoopt,ifmtarg}
 \let\oldcitep\citealp
 \makeatletter
 \renewcommandtwoopt\citep[3][][]{%
 \iffootnote 
  \begingroup\protected\def\harvardand{\&}%
  \@ifmtarg{#1}%
  { {\tiny\fullcite{#3}}}%
  {\@ifmtarg{#2}%
  { {\tiny\fullcite{#3}, #1}}%
  { {\tiny\fullcite{#3}, #1, #2}}}%
  \endgroup%
 \else
  \begingroup\protected\def\harvardand{\&}%
  \@ifmtarg{#1}%
  {\footnote{\fullcite{#3}}}%
  {\@ifmtarg{#2}%
  {\footnote{\fullcite{#3}, #1}}%
  {\footnote{\fullcite{#3}, #1, #2}}}%
  \endgroup%
 \fi
 }
 \makeatother
 \protected\def\harvardand{and}



% -------------------------------------------------------------------- %
% INLUCDE GRAPHICS ....
% -------------------------------------------------------------------- %

  \usepackage{afterpage}
   \newcommand\fullpagefloat[1]{%
    \afterpage{
     \includepdf{#1}
    }
   }

% -------------------------------------------------------------------- %
   \newcommand\spread[2]{%
   \cleartoleft
   \includepdf[pagecommand={\thispagestyle{fancy}},%
               scale=1,pages=#2]{#1}
  }
% -------------------------------------------------------------------- %
   \newcommand\pdfpage[3]{%
   \includepdf[pagecommand={\thispagestyle{fancy}},%
               scale=1,pages=#2#3]{#1}
  }
% -------------------------------------------------------------------- %






















%% -------------------------------------------------------------------- %
%% PDF/X COMPLIANCY
%% -------------------------------------------------------------------- %
%  \usepackage[x-1a]{pdfx}
%  \usepackage{filecontents}
%  \begin{filecontents*}{\jobname.xmpdata}
%  \Keywords{pdfTeX\sep PDF/X-1a\sep PDF/A-b}
%  \Title{$(echo echo) echo $(echo): Commandline Poetics}
%  \Author{Florian Cramer}
%  \Org{LAFKON Publishing}
%  \Doi{123456789}
%  \end{filecontents*}
%  \pdfpageattr{/MediaBox [0 0 436 612]
%               /TrimBox [8 8 428 604]}
%  \pdfcatalog{
%  /OutputIntents [ <<
%  /Info (none)
%  /Type /OutputIntent
%  /S /GTS_PDFX
%  /OutputConditionIdentifier (OFCOM_PO_P1_F60_95)
%  /RegistryName (http://www.color.org/)
%    >> ]
%  }

